{% extends "base.html" %}

{% block title %}
Pod Credentials
{% endblock title %}

{% block page_title %}
Pod Credentials
{% endblock page_title %}

{% block content %}
<div class="mb-10">
    {% if pod %}
    <div class="card bg-base-100 shadow-xl max-w-4xl mx-auto">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-4">Client Credentials</h2>
            <p class="mb-6">
                Use these credentials for server-to-server communication with your Solid pod. 
                Keep these credentials secure and never share them publicly.
            </p>
            
            <div class="alert alert-warning mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
                </svg>
                <div>
                    <h3 class="font-bold">Security Notice!</h3>
                    <div class="text-xs">These credentials provide full access to your pod. Store them securely and rotate them regularly.</div>
                </div>
            </div>

            <div class="space-y-6">
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Client ID</span>
                    </label>
                    <div class="join">
                        <input type="text" 
                               id="client-id" 
                               value="{{ pod.css_client_id | default(value='Not available') }}" 
                               class="input input-bordered join-item flex-1 font-mono text-sm"
                               readonly>
                        <button onclick="copyToClipboard('client-id')" 
                                class="btn btn-primary join-item">
                            Copy
                        </button>
                    </div>
                </div>

                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Client Secret</span>
                    </label>
                    <div class="join">
                        <input type="password" 
                               id="client-secret" 
                               value="{{ pod.css_client_secret | default(value='Not available') }}" 
                               class="input input-bordered join-item flex-1 font-mono text-sm"
                               readonly>
                        <button onclick="togglePassword('client-secret')" 
                                class="btn btn-secondary join-item">
                            Show
                        </button>
                        <button onclick="copyToClipboard('client-secret')" 
                                class="btn btn-primary join-item">
                            Copy
                        </button>
                    </div>
                </div>

                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Token Endpoint</span>
                    </label>
                    <div class="join">
                        <input type="text" 
                               id="token-endpoint" 
                               value="{{ pod.css_client_resource_url | default(value='Not available') }}" 
                               class="input input-bordered join-item flex-1 font-mono text-sm"
                               readonly>
                        <button onclick="copyToClipboard('token-endpoint')" 
                                class="btn btn-primary join-item">
                            Copy
                        </button>
                    </div>
                </div>

                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">WebID</span>
                    </label>
                    <div class="join">
                        <input type="text" 
                               id="webid" 
                               value="{{ pod.webid | default(value='Not available') }}" 
                               class="input input-bordered join-item flex-1 font-mono text-sm"
                               readonly>
                        <button onclick="copyToClipboard('webid')" 
                                class="btn btn-primary join-item">
                            Copy
                        </button>
                    </div>
                </div>
            </div>
        </div>

            <div class="divider"></div>
            
            <h3 class="text-lg font-semibold mb-4">Usage Example</h3>
            <div class="mockup-code">
                <pre data-prefix="$"><code>curl -X POST {{ pod.css_client_resource_url | default(value='TOKEN_ENDPOINT') }} \</code></pre>
                <pre data-prefix=""><code>  -H "Content-Type: application/x-www-form-urlencoded" \</code></pre>
                <pre data-prefix=""><code>  -d "grant_type=client_credentials" \</code></pre>
                <pre data-prefix=""><code>  -d "client_id={{ pod.css_client_id | default(value='CLIENT_ID') }}" \</code></pre>
                <pre data-prefix=""><code>  -d "client_secret={{ pod.css_client_secret | default(value='CLIENT_SECRET') }}"</code></pre>
            </div>

            <div class="card-actions justify-between mt-8">
                <a href="/pod" class="btn btn-outline">Back to Pod Details</a>
                <a href="/dashboard" class="btn btn-primary">Back to Dashboard</a>
            </div>
        </div>
    </div>
    {% else %}
    <div class="hero min-h-96">
        <div class="hero-content text-center">
            <div class="max-w-md">
                <h3 class="text-2xl font-bold text-gray-800">No Pod Available</h3>
                <p class="py-6 text-gray-600">You need to have a pod before viewing credentials.</p>
                <a href="/pod" class="btn btn-primary">
                    Check Pod Status
                </a>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    element.select();
    element.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(element.value).then(function() {
        // Show feedback
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Copied!';
        button.classList.remove('bg-blue-500', 'hover:bg-blue-600');
        button.classList.add('bg-green-500', 'hover:bg-green-600');
        
        setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('bg-green-500', 'hover:bg-green-600');
            button.classList.add('bg-blue-500', 'hover:bg-blue-600');
        }, 2000);
    });
}

function togglePassword(elementId) {
    const element = document.getElementById(elementId);
    const button = event.target;
    
    if (element.type === 'password') {
        element.type = 'text';
        button.textContent = 'Hide';
    } else {
        element.type = 'password';
        button.textContent = 'Show';
    }
}
</script>
{% endblock content %}